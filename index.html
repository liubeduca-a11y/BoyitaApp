<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Boyita Tracker - Estable</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>üçº Boyita Tracker</h1>
            <p id="fecha-actual"></p>
        </header>

        <div class="card">
            <h3>Leche</h3>
            <div class="btn-group">
                <button onclick="setOz(1)">1 oz</button>
                <button onclick="setOz(1.5)">1.5 oz</button>
                <button onclick="setOz(2)">2 oz</button>
            </div>
            <input type="number" id="onzas" inputmode="decimal" placeholder="Onzas manual...">
            <input type="text" id="notaLeche" placeholder="Nota de la toma...">
            <button onclick="guardarAlimento()" class="btn-main">Guardar Toma</button>
        </div>

        <div class="card">
            <h3>Pa√±ales</h3>
            <select id="tipoPa√±al" onchange="cambiarVistaPa√±al()" class="full-select">
                <option value="pipi">Pipi üí¶</option>
                <option value="popo">Popo üí©</option>
            </select>
            <div id="opcionPipi">
                <p>Nivel:</p>
                <input type="range" id="nivelPipi" min="1" max="3" step="1" class="slider">
                <div class="range-labels"><span>Poco</span><span>Medio</span><span>Lleno</span></div>
            </div>
            <div id="opcionPopo" style="display:none;">
                <p>Textura:</p>
                <input type="range" id="texturaPopo" min="1" max="4" step="1" class="slider">
                <div class="range-labels"><span>L√≠q.</span><span>Past.</span><span>Dura</span><span>Sangre</span></div>
            </div>
            <input type="text" id="notaPa√±al" placeholder="Nota del pa√±al...">
            <button onclick="guardarPa√±al()" class="btn-main">Guardar Pa√±al</button>
        </div>

function toggleSueno() {
    const btn = document.getElementById('btn-sueno');
    const detalleDiv = document.getElementById('detalle-despertar');
    const inputNota = document.getElementById('notaSueno');
    const selectEstado = document.getElementById('estadoDespertar');

    if (!durmiendo) {
        // --- EMPIEZA A DORMIR ---
        localStorage.setItem('horaInicio', new Date().toISOString());
        durmiendo = true;
        
        // Cambios visuales inmediatos
        btn.innerText = "¬°Despert√≥! ‚òÄÔ∏è";
        btn.style.backgroundColor = "#f59e0b";
        detalleDiv.style.display = "block";
    } else {
        // --- DESPIERTA (AQU√ç CAPTURAMOS TODO) ---
        const horaInicioStr = localStorage.getItem('horaInicio');
        if (horaInicioStr) {
            const inicio = new Date(horaInicioStr);
            const fin = new Date();
            const duracion = Math.round((fin - inicio) / 1000 / 60);
            
            // CAPTURA CR√çTICA: Leemos los valores ANTES de cualquier otra cosa
            const estado = selectEstado.value;
            const nota = inputNota.value.trim();
            
            let det = `Durmi√≥ ${duracion} min (${estado})`;
            if (nota !== "") {
                det += ` - Nota: ${nota}`;
            }

            // GUARDAMOS
            guardarDato({ tipo: "Sue√±o", detalle: det });
        }

        // RESET DE ESTADO
        localStorage.removeItem('horaInicio');
        durmiendo = false;
        
        // LIMPIEZA VISUAL
        btn.innerText = "Empez√≥ a dormir üåô";
        btn.style.backgroundColor = "#4a5568";
        detalleDiv.style.display = "none";
        inputNota.value = ""; // Limpiamos el texto
    }
}
        <h3>Historial</h3>
        <div id="listaRegistros"></div>
        
        <button onclick="descargarCSV()" class="btn-main" style="background-color: #10b981; margin-top: 20px;">üì• Descargar CSV</button>
        <button onclick="resetearApp()" class="btn-reset">Borrar todo y empezar de cero</button>
    </div>
    <script src="script.js"></script>
</body>
</html>
